# 直播后端技术关键字

## 视频流架构
推拉流 转码 cdn
主播端将视频信息推流边缘cdn，边缘cdn将视频流回源至源站。源站具备转码、多码率等能力。
观众端进入直播间获取拉流地址从cdn获取视频流，cdn回源至源站拉取视频流。

## 房间相关服务
推流与拉流构成了直播基本功能。但是通常，直播业务还会伴随着相关的增值业务。比如消息，礼物，互动等等。这些功能依赖房间等相关服务的构建。
具体服务包括：房间服务，记录房间的基本信息；用户服务，记录用户的基本信息。房间-用户关系服务，记录用户与房间的各类二元关系，如在线观众、封禁、管理员等等。

## 即时消息
直播是强实时场景。一些特效或者互动需要依赖即时消息渲染。所以直播往往依赖IM消息。
- 保活server：客户端与保活server建立长链接
- consumer：接受上游发送的IM消息，将消息相关信息持久化，调用路由层查询客户端信息，通知对应的保活server发送消息
- 存储层：存储消息
- 路由层：存储保活server状态信息，客户端信息等
- 代理层：负责选择并返回保活server地址给客户端，客户端建连

读扩散 vs 写扩散
- 读扩散：群聊发一条消息，只写入发送者消息队列，如果一个用户在多个群聊中，需要拉取每一个群聊发送者的消息队列
- 写扩散：群聊发一条消息，写入每一个接受者的消息队列，消息读取者仅需要拉取各自的消息队列即可