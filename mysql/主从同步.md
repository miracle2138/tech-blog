主从同步指的是mysql数据在主节点写入后通过binlog同步至从节点的过程。

# 主从同步涉及三个线程
## dump线程
位于主节点，负责与从节点的同步线程通信，按照从节点请求的位置发送binlog。主节点将为每一个连接的从节点建立一个dump线程。

## io线程
位于从节点，负责向主节点请求binlog日志，并将日志记录到relay log中。

## sql线程
位于从节点，负责将从节点的relay log重放，执行sql语句。

在早期的mysql版本中，io线程与sql线程是同一个线程。这样造成了binlog传输效率低的问题，导致主从延迟较大以及潜在的数据丢数风险。因为sql的执行和io传输应该解耦，这样即使sql执行慢了，也不影响binlog同步数量。
如果主节点挂了，可以尽可能多的同步日志。即使sql执行慢了也没关系，只是晚生效而已，总不至于丢数据。

# 关于复制模式

## 异步复制
主节点写入成功就响应客户端，不管从节点有没有同步。如果主节点挂了，从节点可能丢数据，一致性较低。

## 半同步复制
主节点写入成功并且等至少一个从节点同步成功才响应客户端。这样主挂了，至少有一个从节点同步到了数据，选主时选这个从即可。一致性较强，但是写入响应延迟升高。
新版mysql在收到从节点ack后才commit事务。

## 同步复制
主节点写入成功并且等至全部从节点同步成功才响应客户端。最强的一致性，任意从节点都可以被选主。

其实mysql的集群模式没有提供数据强一致性的方案如选主等。这些问题还得业务方借助业界一致性协议来解决。比如raft算法，就可以基于大多数理论保证切主时的数据一致性。
mysql提供了半同步复制，但是选主需要业务自己承担，即使采用了半同步复制，选主时只要选择拥有最新数据的从节点即可，这样保证了数据不丢失，但是没有解决脑裂问题，可能产生多主。
归根结底mysql没有提供完成的数据一致性方案。

# 参考
- [揭秘MySQL的主从同步实现方案](https://cloud.tencent.com/developer/article/1845522)
